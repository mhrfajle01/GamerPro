<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Mobile Game Pro — 5 Games (TicTacToe, Guess, Snake, Race, Breakout)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ---------- Base / Layout ---------- */
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;font-family:Inter, 'Segoe UI', Roboto, system-ui, -apple-system;}
    html,body{height:100%; margin:0; padding:0;}
    body{
      margin:0;padding:18px;background:linear-gradient(135deg,#071025 0%,#0b1726 100%);color:#e6eef6;
      display:flex;align-items:center;justify-content:center;
      position: relative;
    }
    .app-container{
      width:100%;max-width:780px;border-radius:16px;overflow:hidden;
      background:linear-gradient(180deg,rgba(8,16,29,0.72),rgba(14,20,33,0.82));
      box-shadow:0 24px 60px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.04);
    }
    header{padding:18px 20px;display:flex;gap:12px;align-items:center;background:linear-gradient(90deg,#0ea5e9,#34d399)}
    header h1{font-size:1.25rem;color:#071025;margin:0;font-weight:700}
    header p{margin-left:auto;font-size:0.9rem;color:rgba(7,17,37,0.9);font-weight:600;opacity:0.95}
    .game-tabs{display:flex;gap:6px;padding:10px;background:rgba(255,255,255,0.02)}
    .tab{flex:1;text-align:center;padding:10px 6px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95rem;color:#98a6b6;user-select:none;transition:all .18s}
    .tab.active{background:linear-gradient(90deg,#052d3a,#07323e);color:#aef0d6;box-shadow:inset 0 -4px 12px rgba(0,0,0,0.4);transform:translateY(-2px)}
    .game-content{padding:18px;min-height:560px;display:flex;gap:18px;flex-direction:column;align-items:stretch}
    .game-section{display:none}
    .game-section.active{display:block;animation:fadeIn .25s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
    .game-title{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .game-title i{font-size:1.4rem;color:#a5f3fc}
    .game-title h2{font-size:1.2rem;margin:0;font-weight:800;color:#e7fbf3}

    /* Shared */
    .canvas-container{display:flex;flex-direction:column;align-items:center;gap:12px}
    .game-canvas{width:100%;max-width:620px;background:linear-gradient(180deg,rgba(9,14,22,0.5),rgba(10,16,26,0.6));border-radius:12px;border:1px solid rgba(255,255,255,0.03);display:block}
    .game-stats{display:flex;gap:8px;width:100%;max-width:620px;justify-content:space-between}
    .stat-box{background:linear-gradient(180deg,rgba(20,29,40,0.45),rgba(12,18,28,0.45));padding:10px 12px;border-radius:10px;width:48%;text-align:center;border:1px solid rgba(255,255,255,0.03)}
    .stat-value{font-size:1.4rem;color:#7ef0c7;font-weight:800}
    .stat-label{font-size:0.85rem;color:#9fb4c6;margin-top:6px}
    .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:8px}
    .btn{background:rgba(255,255,255,0.03);color:#e6eef6;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;display:inline-flex;gap:8px;align-items:center;transition:all .12s}
    .btn-primary{background:linear-gradient(90deg,#34d399,#0ea5e9);color:#071025}
    .btn-danger{background:linear-gradient(90deg,#fb7185,#f97316);color:white}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#cfe9f2}

    /* Tic */
    .tic-board{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:420px;margin:0 auto;padding:10px;background:rgba(255,255,255,0.02);border-radius:12px}
    .cell{aspect-ratio:1;display:flex;justify-content:center;align-items:center;border-radius:10px;font-weight:900;font-size:2.6rem;cursor:pointer;color:#e6eef6;background:linear-gradient(180deg,rgba(4,6,10,0.45),rgba(8,12,16,0.45));border:1px solid rgba(255,255,255,0.02);user-select:none}
    .cell.x{color:#8edfff}.cell.o{color:#7ef0c7}.cell.win{animation:pulse 1.1s infinite;box-shadow:0 6px 22px rgba(0,0,0,0.5) inset;background:linear-gradient(90deg,#34d399,#0ea5e9);color:#071025}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}

    /* Guess */
    .guess-container{max-width:420px;margin:0 auto;padding:14px;background:rgba(255,255,255,0.02);border-radius:12px}
    .input-group{display:flex;gap:8px}
    .input-group input{flex:1;padding:12px;border-radius:10px;border:none;background:rgba(10,16,22,0.6);color:#e6eef6;font-size:1rem;outline:none}
    .game-info{margin-top:12px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);color:#bcd7e3;text-align:center}
    .game-info.success{background:rgba(52,211,153,0.08);color:#7ef0c7}.game-info.error{background:rgba(251,113,133,0.08);color:#ff9aa0}
    .progress{height:8px;background:rgba(255,255,255,0.03);border-radius:6px;overflow:hidden;margin:6px 0}.progress-bar{height:100%;background:linear-gradient(90deg,#34d399,#0ea5e9);width:0%;transition:width .28s}

    /* Directional */
    .directional-controls{display:grid;gap:10px;justify-items:center;align-items:center;margin-top:10px}
    .directional-btn{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);font-size:1.15rem;color:#e6eef6}
    .directional-btn:active{transform:scale(.97)}

    /* Additional Breakout UI */
    .hud{display:flex;gap:10px;align-items:center;justify-content:space-between;width:100%;max-width:620px}
    .small{font-size:0.9rem;color:#9fb4c6}
    
    /* Welcome Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: linear-gradient(135deg, #0d1a30, #0a1120);
      padding: 30px;
      border-radius: 16px;
      max-width: 90%;
      width: 500px;
      text-align: center;
      box-shadow: 0 0 40px rgba(0, 200, 255, 0.3);
      border: 1px solid rgba(100, 200, 255, 0.2);
    }
    
    .modal-content h2 {
      color: #34d399;
      margin-top: 0;
      font-size: 2rem;
    }
    
    .game-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin: 25px 0;
    }
    
    .game-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 10px;
      text-align: left;
      border-left: 4px solid #34d399;
    }
    
    .game-item h3 {
      margin: 0 0 8px 0;
      color: #a5f3fc;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .game-item p {
      margin: 0;
      color: #bcd7e3;
      font-size: 0.95rem;
    }
    
    .start-btn {
      background: linear-gradient(90deg, #0ea5e9, #34d399);
      color: #071025;
      border: none;
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 10px;
    }
    
    .start-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    /* Launch Button for Breakout */
    .launch-btn {
      display: block;
      margin: 15px auto;
      padding: 12px 30px;
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(90deg, #34d399, #0ea5e9);
      color: #071025;
      border: none;
      border-radius: 50px;
      cursor: pointer;
    }
    
    /* Fullscreen */
    :fullscreen .app-container {
      width: 100%;
      max-width: none;
      height: 100%;
      border-radius: 0;
    }
    
    :fullscreen .game-content {
      min-height: calc(100vh - 120px);
    }

    /* Responsive */
    @media (max-width:720px){.game-content{padding:14px}.game-stats{flex-direction:column}.stat-box{width:100%}
      header {flex-wrap: wrap; justify-content: center;}
      header p {margin-left: 0; margin-top: 8px; width: 100%; text-align: center;}
    }
    
    @media (max-width: 500px) {
      .game-tabs {flex-wrap: wrap;}
      .tab {min-width: 30%; flex: none;}
    }
  </style>
</head>
<body>
  <!-- Welcome Modal -->
  <div class="modal-overlay" id="welcomeModal">
    <div class="modal-content">
      <h2><i class="fas fa-gamepad"></i> Welcome to Mobile Game Pro!</h2>
      <p>Enjoy 5 exciting games in one place with enhanced mobile controls</p>
      
      <div class="game-list">
        <div class="game-item">
          <h3><i class="fas fa-times"></i> Tic Tac Toe</h3>
          <p>Classic X and O game with adjustable difficulty</p>
        </div>
        <div class="game-item">
          <h3><i class="fas fa-question"></i> Guess the Number</h3>
          <p>Find the secret number in limited attempts</p>
        </div>
        <div class="game-item">
          <h3><i class="fas fa-worm"></i> Snake</h3>
          <p>Control the snake to eat food and grow longer</p>
        </div>
        <div class="game-item">
          <h3><i class="fas fa-car-side"></i> Car Race</h3>
          <p>Dodge obstacles in this endless racing game</p>
        </div>
        <div class="game-item">
          <h3><i class="fas fa-basketball-ball"></i> Breakout</h3>
          <p>Break bricks with a bouncing ball and paddle</p>
        </div>
      </div>
      
      <p><strong>Mobile Controls:</strong> Swipe or use on-screen buttons</p>
      <button class="start-btn" id="startBtn">Start Playing</button>
    </div>
  </div>

  <div class="app-container">
    <header>
      <i class="fas fa-gamepad" style="font-size:1.4rem;color:#071025"></i>
      <h1>Mobile Game Pro</h1>
      <p>Now with Breakout — Responsive • Mobile + Keyboard</p>
    </header>

    <div class="game-tabs" role="tablist">
      <div class="tab active" data-tab="tic" role="tab" aria-selected="true"><i class="fas fa-times"></i> Tic Tac Toe</div>
      <div class="tab" data-tab="guess" role="tab"><i class="fas fa-question"></i> Guess Number</div>
      <div class="tab" data-tab="snake" role="tab"><i class="fas fa-worm"></i> Snake</div>
      <div class="tab" data-tab="race" role="tab"><i class="fas fa-car-side"></i> Car Race</div>
      <div class="tab" data-tab="breakout" role="tab"><i class="fas fa-basketball-ball"></i> Breakout</div>
    </div>

    <div class="game-content">
      <!-- Tic -->
      <div class="game-section active" id="tic-section">
        <div class="game-title"><i class="fas fa-times"></i><h2>Tic Tac Toe</h2></div>
        <div class="tic-board" id="tic-board" aria-label="Tic tac toe board">
          <div class="cell" data-index="0"></div><div class="cell" data-index="1"></div><div class="cell" data-index="2"></div>
          <div class="cell" data-index="3"></div><div class="cell" data-index="4"></div><div class="cell" data-index="5"></div>
          <div class="cell" data-index="6"></div><div class="cell" data-index="7"></div><div class="cell" data-index="8"></div>
        </div>
        <div style="text-align:center;margin-top:12px;">
          <div id="tic-status" style="font-weight:700;color:#bcd7e3;">Player X's turn</div>
          <div class="controls" style="margin-top:10px;">
            <select class="btn btn-ghost" id="modeSelect" aria-label="Game Mode">
              <option value="two">Two Players</option>
              <option value="single">Vs Computer</option>
            </select>
            <select class="btn btn-ghost" id="difficultySelect" aria-label="Difficulty">
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>
            <button class="btn btn-danger" id="ticReset"><i class="fas fa-redo"></i> Restart</button>
            <button class="btn" id="ticMute"><i class="fas fa-volume-up"></i></button>
          </div>
        </div>
      </div>

      <!-- Guess -->
      <div class="game-section" id="guess-section">
        <div class="game-title"><i class="fas fa-question"></i><h2>Guess the Number</h2></div>
        <div class="guess-container" role="region" aria-label="Guess the number">
          <p style="text-align:center;color:#9fb4c6;">I'm thinking of a number between 1 and <strong id="rangeMax">100</strong></p>
          <div class="input-group">
            <input id="guessInput" type="number" placeholder="Enter your guess" min="1" aria-label="Guess input">
            <button class="btn btn-primary" id="guessBtn">Guess</button>
          </div>
          <div class="game-info" id="guess-info">Enter your first guess above</div>
          <div style="display:flex;align-items:center;gap:10px;margin-top:10px;">
            <div class="progress" style="flex:1;"><div id="progressBar" class="progress-bar"></div></div>
            <div style="min-width:78px;text-align:right;color:#cfe9f2;font-weight:700;" id="attemptsCount">0/10</div>
          </div>
          <div class="controls" style="margin-top:12px;">
            <select class="btn btn-ghost" id="guessDifficulty">
              <option value="easy">Easy (1-10)</option>
              <option value="medium">Medium (1-50)</option>
              <option value="hard" selected>Hard (1-100)</option>
            </select>
            <button class="btn btn-danger" id="guessReset"><i class="fas fa-redo"></i> Restart</button>
            <button class="btn" id="guessMute"><i class="fas fa-volume-up"></i></button>
          </div>
        </div>
      </div>

      <!-- Snake -->
      <div class="game-section" id="snake-section">
        <div class="game-title"><i class="fas fa-worm"></i><h2>Snake</h2></div>
        <div class="canvas-container">
          <canvas id="snakeCanvas" class="game-canvas" width="400" height="400" aria-label="Snake game"></canvas>
          <div class="game-stats">
            <div class="stat-box"><div class="stat-value" id="snake-score">0</div><div class="stat-label">Score</div></div>
            <div class="stat-box"><div class="stat-value" id="snake-highscore">0</div><div class="stat-label">High Score</div></div>
          </div>
          <div class="controls">
            <select class="btn btn-ghost" id="snakeSpeed">
              <option value="200">Slow</option>
              <option value="120" selected>Medium</option>
              <option value="70">Fast</option>
            </select>
            <button class="btn btn-danger" id="snakeReset"><i class="fas fa-redo"></i> Restart</button>
            <button class="btn" id="snakePause"><i class="fas fa-pause"></i></button>
            <button class="btn" id="snakeFull"><i class="fas fa-expand"></i></button>
          </div>
          <div class="directional-controls" style="grid-template-columns:repeat(3,56px);grid-auto-rows:56px;">
            <div></div>
            <button class="directional-btn" id="upBtn" aria-label="Up"><i class="fas fa-arrow-up"></i></button>
            <div></div>
            <button class="directional-btn" id="leftBtn" aria-label="Left"><i class="fas fa-arrow-left"></i></button>
            <button class="directional-btn" id="downBtn" aria-label="Down"><i class="fas fa-arrow-down"></i></button>
            <button class="directional-btn" id="rightBtn" aria-label="Right"><i class="fas fa-arrow-right"></i></button>
          </div>
        </div>
      </div>

      <!-- Race -->
      <div class="game-section" id="race-section">
        <div class="game-title"><i class="fas fa-car-side"></i><h2>Car Race</h2></div>
        <div class="canvas-container">
          <canvas id="raceCanvas" class="game-canvas" width="400" height="600" aria-label="Car race"></canvas>
          <div class="game-stats">
            <div class="stat-box"><div class="stat-value" id="race-score">0</div><div class="stat-label">Score</div></div>
            <div class="stat-box"><div class="stat-value" id="race-highscore">0</div><div class="stat-label">High Score</div></div>
          </div>
          <div class="controls">
            <button class="btn btn-danger" id="raceReset"><i class="fas fa-redo"></i> Restart</button>
            <button class="btn" id="racePause"><i class="fas fa-pause"></i></button>
            <button class="btn" id="raceMute"><i class="fas fa-volume-up"></i></button>
            <button class="btn" id="raceFull"><i class="fas fa-expand"></i></button>
          </div>
          <div class="directional-controls" style="grid-template-columns:repeat(2,1fr);margin-top:8px;">
            <button class="directional-btn" id="raceLeftBtn" aria-label="Left"><i class="fas fa-arrow-left"></i></button>
            <button class="directional-btn" id="raceRightBtn" aria-label="Right"><i class="fas fa-arrow-right"></i></button>
          </div>
        </div>
      </div>

      <!-- Breakout -->
      <div class="game-section" id="breakout-section">
        <div class="game-title"><i class="fas fa-basketball-ball"></i><h2>Breakout — Brick Breaker</h2></div>
        <div class="canvas-container">
          <canvas id="breakoutCanvas" class="game-canvas" width="620" height="420" aria-label="Breakout game"></canvas>
          <div class="hud" style="margin-top:6px;">
            <div class="small">Score: <strong id="break-score">0</strong></div>
            <div class="small">High: <strong id="break-high">0</strong></div>
            <div style="display:flex;gap:8px">
              <button class="btn btn-ghost" id="break-pause"><i class="fas fa-pause"></i></button>
              <button class="btn btn-primary" id="break-restart"><i class="fas fa-redo"></i> Restart</button>
              <button class="btn" id="break-mute"><i class="fas fa-volume-up"></i></button>
              <button class="btn" id="break-full"><i class="fas fa-expand"></i></button>
            </div>
            <div class="small">Lives: <strong id="break-lives">3</strong></div>
          </div>
          <button class="launch-btn" id="break-launch">Launch Ball</button>
          <div class="controls" style="margin-top:8px;">
            <div class="small">Controls: ← → or A/D, drag on mobile</div>
          </div>
        </div>
      </div>

    </div>

    <footer style="padding:12px;text-align:center;color:#9fb4c6;border-top:1px solid rgba(255,255,255,0.02);">A Professional Mobile Gaming Collection — Now 5 games</footer>
  </div>

  <script>
  /* =========================
     Sound Manager (safe)
     ========================= */
  const SoundManager = {
    enabled: true,
    sounds: {
      click: new Audio('sounds/click.mp3'),
      win: new Audio('sounds/win.mp3'),
      draw: new Audio('sounds/crash.mp3'),
      success: new Audio('sounds/win.mp3'),
      error: new Audio('sounds/crash.mp3'),
      eat: new Audio('sounds/eat.mp3'),
      crash: new Audio('sounds/crash.mp3'),
      brick: new Audio('sounds/click.mp3')
    },
    play(name){
      if(!this.enabled) return;
      const s = this.sounds[name];
      if(!s) return;
      s.currentTime = 0;
      s.play().catch(()=>{/* ignore autoplay errors */});
    },
    toggle(){ this.enabled = !this.enabled; return this.enabled; }
  };

  /* =========================
     Welcome Modal
     ========================= */
  const welcomeModal = document.getElementById('welcomeModal');
  const startBtn = document.getElementById('startBtn');
  
  // Show welcome modal on first load
  if (!sessionStorage.getItem('gameLoaded')) {
    welcomeModal.style.display = 'flex';
    sessionStorage.setItem('gameLoaded', 'true');
  } else {
    welcomeModal.style.display = 'none';
  }
  
  startBtn.addEventListener('click', () => {
    welcomeModal.style.display = 'none';
  });

  /* =========================
     Tabs init (single-init pattern)
     ========================= */
  const tabs = document.querySelectorAll('.tab');
  const sections = document.querySelectorAll('.game-section');
  tabs.forEach(tab=>{
    tab.addEventListener('click', ()=>{
      const id = tab.dataset.tab;
      tabs.forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      sections.forEach(s=>{
        if(s.id === id + '-section'){ 
          s.classList.add('active'); 
          if(id==='tic') TicModule.init(); 
          if(id==='guess') GuessModule.init(); 
          if(id==='snake') SnakeModule.init(); 
          if(id==='race') RaceModule.init(); 
          if(id==='breakout') BreakoutModule.init(); 
        }
        else s.classList.remove('active');
      });
      if(id!=='snake') SnakeModule.stopGame();
      if(id!=='race') RaceModule.stopGame();
      if(id!=='breakout') BreakoutModule.stopGame();
    });
  });

  /* =========================
     Fullscreen helper
     ========================= */
  function toggleFullscreen(element) {
    if (!document.fullscreenElement) {
      element.requestFullscreen().catch(err => {
        console.error(`Error attempting to enable fullscreen: ${err.message}`);
      });
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      }
    }
  }

  /* =========================
     TicTacToe Module
     ========================= */
  const TicModule = (function(){
    const boardEl = document.getElementById('tic-board'); const cells = boardEl.querySelectorAll('.cell');
    const statusEl = document.getElementById('tic-status'); const modeSelect = document.getElementById('modeSelect');
    const difficultySelect = document.getElementById('difficultySelect'); const resetBtn = document.getElementById('ticReset');
    const muteBtn = document.getElementById('ticMute');
    const winPatterns = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    let gameBoard = Array(9).fill(''), currentPlayer='X', gameActive=true, gameMode='two', difficulty='easy', computerTimeout=null;
    let initialized=false;
    function init(){ if(initialized) return; initialized=true;
      cells.forEach(cell=>cell.addEventListener('click', handleCellClick));
      resetBtn.addEventListener('click', resetGame);
      modeSelect.addEventListener('change', resetGame);
      difficultySelect.addEventListener('change', resetGame);
      muteBtn.addEventListener('click', ()=>{ const on = SoundManager.toggle(); muteBtn.innerHTML = on?'<i class="fas fa-volume-up"></i>':'<i class="fas fa-volume-mute"></i>'; });
      resetGame();
    }
    function resetGame(){ if(computerTimeout){ clearTimeout(computerTimeout); computerTimeout=null; } gameBoard = Array(9).fill(''); currentPlayer='X'; gameActive=true; gameMode = modeSelect.value; difficulty = difficultySelect.value; statusEl.textContent="Player X's turn"; statusEl.style.color='#bcd7e3'; cells.forEach(cell=>{ cell.textContent=''; cell.className='cell'; }); }
    function handleCellClick(e){ const idx = parseInt(e.currentTarget.dataset.index,10); if(!gameActive || gameBoard[idx]!=='' || (gameMode==='single' && currentPlayer==='O')) return; SoundManager.play('click'); placeMark(idx,currentPlayer); if(checkForWinner()) return; if(checkForDraw()) return; changePlayer(); if(gameMode==='single' && currentPlayer==='O' && gameActive){ statusEl.textContent="Computer is thinking..."; computerTimeout = setTimeout(computerMove,400 + Math.random()*400); } }
    function placeMark(i,p){ gameBoard[i]=p; const cell = boardEl.querySelector(`.cell[data-index="${i}"]`); if(cell){ cell.textContent = p; cell.classList.add(p.toLowerCase()); } }
    function changePlayer(){ currentPlayer = currentPlayer==='X' ? 'O' : 'X'; statusEl.textContent = `Player ${currentPlayer}'s turn`; }
    function checkForWinner(){ for(const pat of winPatterns){ const [a,b,c]=pat; if(gameBoard[a] && gameBoard[a] === gameBoard[b] && gameBoard[a] === gameBoard[c]){ gameActive=false; statusEl.textContent = `🎉 Player ${gameBoard[a]} wins!`; statusEl.style.color='#7ef0c7'; pat.forEach(i=>boardEl.querySelector(`.cell[data-index="${i}"]`).classList.add('win')); SoundManager.play('win'); return true; } } return false; }
    function checkForDraw(){ if(!gameBoard.includes('') && gameActive){ gameActive=false; statusEl.textContent = "😐 Game ended in a draw!"; statusEl.style.color='#ff9aa0'; SoundManager.play('draw'); return true; } return false; }
    function computerMove(){ if(!gameActive) return; let idx=null; if(difficulty==='easy') idx=getRandomMove(); else if(difficulty==='medium') idx=getMediumMove(); else idx=getBestMove(); if(idx!==null){ placeMark(idx,'O'); if(checkForWinner()) return; if(checkForDraw()) return; changePlayer(); } }
    function getRandomMove(){ const empties = gameBoard.map((v,i)=>v===''?i:null).filter(x=>x!==null); return empties.length?empties[Math.floor(Math.random()*empties.length)]:null; }
    function isWinner(b,p){ return winPatterns.some(pat => pat.every(i=>b[i]===p)); }
    function getMediumMove(){ for(let p of ['O','X']){ for(let i=0;i<9;i++){ if(gameBoard[i]===''){ const copy=[...gameBoard]; copy[i]=p; if(isWinner(copy,p)) return i; } } } if(gameBoard[4]==='') return 4; const corners=[0,2,6,8].filter(i=>gameBoard[i]===''); if(corners.length) return corners[Math.floor(Math.random()*corners.length)]; return getRandomMove(); }
    function getBestMove(){ let best=-Infinity, move=null; for(let i=0;i<9;i++){ if(gameBoard[i]===''){ const copy=[...gameBoard]; copy[i]='O'; const score=minimax(copy,0,false); if(score>best){ best=score; move=i; } } } return move; }
    function minimax(board,depth,isMax){ if(isWinner(board,'O')) return 10-depth; if(isWinner(board,'X')) return depth-10; if(!board.includes('')) return 0; if(isMax){ let best=-Infinity; for(let i=0;i<9;i++) if(board[i]===''){ const c=[...board]; c[i]='O'; best=Math.max(best,minimax(c,depth+1,false)); } return best; } else { let best=Infinity; for(let i=0;i<9;i++) if(board[i]===''){ const c=[...board]; c[i]='X'; best=Math.min(best,minimax(c,depth+1,true)); } return best; } }
    return { init };
  })();

  /* =========================
     Guess Module
     ========================= */
  const GuessModule = (function(){
    const guessInput = document.getElementById('guessInput');
    const guessBtn = document.getElementById('guessBtn');
    const resetBtn = document.getElementById('guessReset');
    const difficultySelect = document.getElementById('guessDifficulty');
    const infoEl = document.getElementById('guess-info');
    const rangeEl = document.getElementById('rangeMax');
    const attemptsEl = document.getElementById('attemptsCount');
    const progressBar = document.getElementById('progressBar');
    const muteBtn = document.getElementById('guessMute');
    let secret=0, attempts=0, maxAttempts=10, rangeMax=100, active=false, initialized=false;
    function init(){ if(initialized) return; initialized=true; guessBtn.addEventListener('click', checkGuess); resetBtn.addEventListener('click', startGame); difficultySelect.addEventListener('change', startGame); guessInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') checkGuess(); }); muteBtn.addEventListener('click', ()=>{ const on = SoundManager.toggle(); muteBtn.innerHTML = on ? '<i class=\"fas fa-volume-up\"></i>' : '<i class=\"fas fa-volume-mute\"></i>'; }); startGame(); }
    function startGame(){ const d = difficultySelect.value; if(d==='easy'){ rangeMax=10; maxAttempts=5; } else if(d==='medium'){ rangeMax=50; maxAttempts=7; } else { rangeMax=100; maxAttempts=10; } secret=Math.floor(Math.random()*rangeMax)+1; attempts=0; active=true; rangeEl.textContent=rangeMax; infoEl.textContent=`Guess a number between 1 and ${rangeMax}`; infoEl.className='game-info'; update(); guessInput.value=''; guessInput.focus(); }
    function checkGuess(){ if(!active) return; const g=parseInt(guessInput.value,10); if(isNaN(g)||g<1||g>rangeMax){ infoEl.textContent=`Please enter a number between 1 and ${rangeMax}`; infoEl.className='game-info error'; SoundManager.play('error'); return; } attempts++; if(g===secret){ infoEl.innerHTML=`🎉 Correct! The number was ${secret}.<br>You guessed it in ${attempts} attempts!`; infoEl.className='game-info success'; active=false; SoundManager.play('success'); } else if(attempts>=maxAttempts){ infoEl.innerHTML=`Game over! The number was ${secret}.`; infoEl.className='game-info error'; active=false; SoundManager.play('error'); } else { const hint = g<secret ? 'higher' : 'lower'; infoEl.textContent=`Try again — the number is ${hint} than ${g}.`; infoEl.className='game-info'; SoundManager.play('click'); } update(); guessInput.value=''; guessInput.focus(); }
    function update(){ attemptsEl.textContent = `${attempts}/${maxAttempts}`; const pct = Math.min(100, (attempts/maxAttempts)*100); progressBar.style.width = pct + '%'; if(pct>80) progressBar.style.background = '#fb7185'; else if(pct>60) progressBar.style.background = '#f59e0b'; else progressBar.style.background = 'linear-gradient(90deg,#34d399,#0ea5e9)'; }
    return { init };
  })();

  /* =========================
     Snake Module (with swipe controls)
     ========================= */
  const SnakeModule = (function(){
    const canvas = document.getElementById('snakeCanvas'); const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('snake-score'); const highEl = document.getElementById('snake-highscore');
    const resetBtn = document.getElementById('snakeReset'); const speedSelect = document.getElementById('snakeSpeed');
    const upBtn = document.getElementById('upBtn'), downBtn = document.getElementById('downBtn'), leftBtn = document.getElementById('leftBtn'), rightBtn = document.getElementById('rightBtn');
    const pauseBtn = document.getElementById('snakePause');
    const fullBtn = document.getElementById('snakeFull');
    let gridSize = 20, cols=20, rows=20, snake=[], food=null, dir={x:1,y:0}, score=0, high=0, running=false, lastTime=0, speed=120, initialized=false, pointerDirs={up:false,down:false,left:false,right:false};
    let touchStartX = 0, touchStartY = 0;
    
    function init(){ if(initialized) return; initialized=true; bindEvents(); loadHigh(); resetGame(); window.addEventListener('resize', handleResize); handleResize(); }
    
    function bindEvents(){
      resetBtn.addEventListener('click', resetGame); 
      speedSelect.addEventListener('change', ()=>{ speed = parseInt(speedSelect.value,10); });
      pauseBtn.addEventListener('click', ()=>{ running=!running; pauseBtn.innerHTML = running?'<i class=\"fas fa-pause\"></i>':'<i class=\"fas fa-play\"></i>'; lastTime = performance.now(); requestAnimationFrame(loop); });
      fullBtn.addEventListener('click', ()=>{ toggleFullscreen(canvas); });
      
      // Touch swipe events
      canvas.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        e.preventDefault();
      });
      
      canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
      });
      
      canvas.addEventListener('touchend', (e) => {
        if (!running) return;
        const touchEndX = e.changedTouches[0].clientX;
        const touchEndY = e.changedTouches[0].clientY;
        const dx = touchEndX - touchStartX;
        const dy = touchEndY - touchStartY;
        const absDx = Math.abs(dx);
        const absDy = Math.abs(dy);
        
        if (Math.max(absDx, absDy) < 20) return;
        
        if (absDx > absDy) {
          if (dx > 0 && dir.x === 0) {
            setDir('right');
          } else if (dx < 0 && dir.x === 0) {
            setDir('left');
          }
        } else {
          if (dy > 0 && dir.y === 0) {
            setDir('down');
          } else if (dy < 0 && dir.y === 0) {
            setDir('up');
          }
        }
        e.preventDefault();
      });
      
      // Keyboard controls
      document.addEventListener('keydown', (e)=>{
        if(!document.getElementById('snake-section').classList.contains('active')) return;
        switch(e.key){
          case 'ArrowUp': setDir('up'); break;
          case 'ArrowDown': setDir('down'); break;
          case 'ArrowLeft': setDir('left'); break;
          case 'ArrowRight': setDir('right'); break;
        }
      });
    }
    
    function setDir(dirName){ 
      if(dirName==='up'&&dir.y===0){ dir={x:0,y:-1}; SoundManager.play('click'); } 
      if(dirName==='down'&&dir.y===0){ dir={x:0,y:1}; SoundManager.play('click'); } 
      if(dirName==='left'&&dir.x===0){ dir={x:-1,y:0}; SoundManager.play('click'); } 
      if(dirName==='right'&&dir.x===0){ dir={x:1,y:0}; SoundManager.play('click'); } 
    }
    
    function handleResize(){ const max = Math.min(window.innerWidth*0.88, 520); canvas.width = canvas.height = Math.floor(max / gridSize) * gridSize; cols = canvas.width / gridSize; rows = canvas.height / gridSize; draw(); }
    function resetGame(){ running = true; lastTime = performance.now(); snake=[{x:Math.floor(cols/2),y:Math.floor(rows/2)}]; dir={x:1,y:0}; score=0; speed = parseInt(speedSelect.value,10); generateFood(); document.getElementById('snake-score').textContent = score; requestAnimationFrame(loop); }
    function loadHigh(){ high = parseInt(localStorage.getItem('snakeHigh')||'0',10); document.getElementById('snake-highscore').textContent = high; }
    function saveHigh(){ if(score>high){ high = score; localStorage.setItem('snakeHigh', high); document.getElementById('snake-highscore').textContent = high; } }
    function generateFood(){ let p; do{ p={x:Math.floor(Math.random()*cols), y:Math.floor(Math.random()*rows)} } while(snake.some(s=>s.x===p.x&&s.y===p.y)); food = p; }
    function loop(ts){ if(!running){ lastTime = ts; requestAnimationFrame(loop); return; } const elapsed = ts - lastTime; if(elapsed >= speed){ lastTime = ts; update(); draw(); } requestAnimationFrame(loop); }
    function update(){ const head = {x:snake[0].x + dir.x, y:snake[0].y + dir.y}; if(head.x<0||head.x>=cols||head.y<0||head.y>=rows) return gameOver(); if(snake.some((s,i)=>i>0&&s.x===head.x&&s.y===head.y)) return gameOver(); snake.unshift(head); if(head.x===food.x && head.y===food.y){ score+=10; document.getElementById('snake-score').textContent = score; SoundManager.play('eat'); generateFood(); } else snake.pop(); }
    function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='rgba(4,7,10,0.6)'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#34d399'; for(let i=0;i<snake.length;i++){ const s=snake[i]; ctx.fillRect(s.x*gridSize, s.y*gridSize, gridSize-1, gridSize-1); } ctx.fillStyle='#fb7185'; ctx.fillRect(food.x*gridSize, food.y*gridSize, gridSize-1, gridSize-1); }
    function gameOver(){ running=false; SoundManager.play('crash'); saveHigh(); ctx.fillStyle='rgba(4,6,8,0.85)'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#fb7185'; ctx.font='bold 28px Arial'; ctx.textAlign='center'; ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 10); ctx.fillStyle='#e6eef6'; ctx.font='18px Arial'; ctx.fillText(`Score: ${score}`, canvas.width/2, canvas.height/2 + 22); }
    function stopGame(){ running=false; }
    return { init, stopGame };
  })();

  /* =========================
     Race Module (with touch controls)
     ========================= */
  const RaceModule = (function(){
    const canvas = document.getElementById('raceCanvas'); const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('race-score'); const highEl = document.getElementById('race-highscore');
    const resetBtn = document.getElementById('raceReset'); const leftBtn = document.getElementById('raceLeftBtn'); const rightBtn = document.getElementById('raceRightBtn');
    const pauseBtn = document.getElementById('racePause');
    const muteBtn = document.getElementById('raceMute');
    const fullBtn = document.getElementById('raceFull');
    let player=null, obstacles=[], lastTime=0, score=0, high=0, running=false, initialized=false, laneCount=3, laneRects=[], pointerLeft=false, pointerRight=false, spawnTimer=0, spawnInterval=900;
    
    function init(){ if(initialized) return; initialized=true; handleResize(); window.addEventListener('resize', handleResize); bindEvents(); loadHigh(); resetGame(); }
    
    function bindEvents() {
      resetBtn.addEventListener('click', resetGame); 
      pauseBtn.addEventListener('click', ()=>{ running=!running; pauseBtn.innerHTML = running?'<i class=\"fas fa-pause\"></i>':'<i class=\"fas fa-play\"></i>'; });
      muteBtn.addEventListener('click', ()=>{ const on = SoundManager.toggle(); muteBtn.innerHTML = on ? '<i class=\"fas fa-volume-up\"></i>' : '<i class=\"fas fa-volume-mute\"></i>'; });
      fullBtn.addEventListener('click', ()=>{ toggleFullscreen(canvas); });
      
      // Touch events for mobile
      canvas.addEventListener('touchstart', (e) => {
        if (!running) return;
        const rect = canvas.getBoundingClientRect();
        const touchX = e.touches[0].clientX - rect.left;
        if (touchX < canvas.width / 2) {
          movePlayer('left');
        } else {
          movePlayer('right');
        }
        e.preventDefault();
      });
      
      // Keyboard controls
      document.addEventListener('keydown', (e)=>{
        if(!document.getElementById('race-section').classList.contains('active')) return;
        if(e.key==='ArrowLeft') movePlayer('left'); 
        if(e.key==='ArrowRight') movePlayer('right');
      });
    }
    
    function handleResize(){ const max = Math.min(window.innerWidth*0.9,520); canvas.width = Math.floor(max); canvas.height = Math.floor(max*1.5); setupRoad(); }
    function setupRoad(){ laneRects=[]; const roadLeft = canvas.width*0.12; const roadWidth = canvas.width*0.76; const laneWidth = roadWidth / laneCount; for(let i=0;i<laneCount;i++) laneRects.push({left:roadLeft + i*laneWidth, width:laneWidth}); }
    function resetGame(){ running=true; obstacles=[]; score=0; spawnTimer=0; const carW = canvas.width/6; const carH = carW*1.3; player={width:carW,height:carH,lane:Math.floor(laneCount/2)}; player.x = laneRects[player.lane].left + (laneRects[player.lane].width - player.width)/2; player.y = canvas.height - player.height - 24; player.speed = canvas.width * 0.012; scoreEl.textContent = score; requestAnimationFrame(loop); }
    function loop(ts){ if(!running){ lastTime=ts; requestAnimationFrame(loop); return; } if(!lastTime) lastTime=ts; const dt = ts-lastTime; lastTime=ts; update(dt); draw(); requestAnimationFrame(loop); }
    function update(dt){ spawnTimer += dt; if(spawnTimer >= spawnInterval){ spawnTimer=0; spawnObstacle(); spawnInterval = 700 + Math.random()*1200; } for(let i=obstacles.length-1;i>=0;i--){ const o=obstacles[i]; o.y += o.speed*(dt/16); if(o.y > canvas.height + 80) obstacles.splice(i,1); else if(checkCollision(player,o)) return gameOver(); } score += Math.floor(dt/16); scoreEl.textContent = score; }
    function spawnObstacle(){ const lane = Math.floor(Math.random()*laneCount); const laneRect = laneRects[lane]; const width = player.width*(0.8 + Math.random()*0.6); const height = player.height*(0.6 + Math.random()*0.6); const x = laneRect.left + (laneRect.width - width)/2; const y = -height-10; const speed = 2 + Math.random()*3; obstacles.push({x,y,width,height,speed}); }
    function drawRoad(){ ctx.fillStyle='#08320b'; ctx.fillRect(0,0,canvas.width,canvas.height); const roadLeft = canvas.width*0.12; const roadWidth = canvas.width*0.76; ctx.fillStyle='#2b2b34'; ctx.fillRect(roadLeft,0,roadWidth,canvas.height); ctx.fillStyle='#d6d6d6'; ctx.fillRect(roadLeft-6,0,6,canvas.height); ctx.fillRect(roadLeft+roadWidth,0,6,canvas.height); ctx.fillStyle='rgba(255,255,255,0.85)'; const centerX = roadLeft + roadWidth/2 - 3; const dashH = Math.max(12, Math.floor(canvas.height/20)); for(let y= - (score%40); y < canvas.height; y += dashH*2){ ctx.fillRect(centerX, y, 6, dashH); } }
    function drawPlayerCar(){ const x=player.x, y=player.y, w=player.width, h=player.height; roundRect(ctx,x,y,w,h,Math.max(6,w*0.06),'#0ea5e9'); roundRect(ctx,x + w*0.15, y - h*0.25, w*0.7, h*0.5, Math.max(6,w*0.05),'#7ef0c7'); ctx.fillStyle='rgba(255,255,255,0.85)'; ctx.fillRect(x + w*0.27, y - h*0.16, w*0.18, h*0.28); ctx.fillRect(x + w*0.55, y - h*0.16, w*0.18, h*0.28); ctx.fillStyle='#111'; const wheelW = w*0.22, wheelH= h*0.22; ctx.fillRect(x + w*0.12, y + h - wheelH/2, wheelW, wheelH); ctx.fillRect(x + w - w*0.12 - wheelW, y + h - wheelH/2, wheelW, wheelH); ctx.fillStyle='#fff3a6'; ctx.fillRect(x + w - 6, y + h*0.2, 6, 6); }
    function roundRect(ctx,x,y,w,h,r,fill){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); ctx.fillStyle=fill; ctx.fill(); }
    function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); drawRoad(); ctx.fillStyle='#f87171'; obstacles.forEach(o=> ctx.fillRect(o.x, o.y, o.width, o.height)); drawPlayerCar(); ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.font='14px Arial'; ctx.fillText(`Score: ${score}`, 12, 20); }
    function checkCollision(r1,r2){ return r1.x < r2.x + r2.width && r1.x + r1.width > r2.x && r1.y < r2.y + r2.height && r1.y + r1.height > r2.y;}
    function movePlayer(direction){ if(!player) return; if(direction==='left'&&player.lane>0){ player.lane--; player.x = laneRects[player.lane].left + (laneRects[player.lane].width - player.width)/2; } if(direction==='right'&&player.lane < laneCount -1){ player.lane++; player.x = laneRects[player.lane].left + (laneRects[player.lane].width - player.width)/2; } SoundManager.play('click'); }
    function gameOver(){ running=false; SoundManager.play('crash'); if(score>high){ high=score; localStorage.setItem('raceHigh', high); highEl.textContent = high; } ctx.fillStyle='rgba(4,6,8,0.85)'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#fb7185'; ctx.font = 'bold ' + Math.floor(canvas.width/10) + 'px Arial'; ctx.textAlign='center'; ctx.fillText('CRASHED!', canvas.width/2, canvas.height/2 - 20); ctx.fillStyle='#e6eef6'; ctx.font = Math.floor(canvas.width/18) + 'px Arial'; ctx.fillText(`Score: ${score}`, canvas.width/2, canvas.height/2 + 26); }
    function loadHigh(){ high = parseInt(localStorage.getItem('raceHigh')||'0',10); document.getElementById('race-highscore').textContent = high; }
    function stopGame(){ running=false; }
    return { init, stopGame };
  })();

  /* =========================
     Breakout Module (with mobile controls)
     ========================= */
  const BreakoutModule = (function(){
    const canvas = document.getElementById('breakoutCanvas'), ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('break-score'), livesEl = document.getElementById('break-lives'), highEl = document.getElementById('break-high');
    const pauseBtn = document.getElementById('break-pause'), restartBtn = document.getElementById('break-restart'), muteBtn = document.getElementById('break-mute'), fullBtn = document.getElementById('break-full'), launchBtn = document.getElementById('break-launch');
    let width = 620, height = 420, scale = 1;
    let paddle, ball, bricks = [], particles = [], powerUps = [], score = 0, lives = 3, level = 1;
    let running = false, paused = false, initialized=false, high = 0, waitingLaunch = true;
    const ROWS_BASE = 4, COLS = 10;
    const COLORS = ['#f97316','#f59e0b','#34d399','#0ea5e9','#a78bfa'];

    function init(){
      if(initialized) return; initialized=true;
      setupCanvas();
      bindControls();
      loadHigh();
      resetGame();
      window.addEventListener('resize', onResize);
    }

    function setupCanvas(){
      const containerWidth = Math.min(window.innerWidth*0.92, 720);
      width = Math.floor(containerWidth);
      height = Math.floor(containerWidth * 0.68);
      canvas.width = width; canvas.height = height;
      scale = canvas.width / 620;
    }

    function bindControls(){
      restartBtn.addEventListener('click', ()=>{ resetGame(); });
      pauseBtn.addEventListener('click', ()=>{ paused = !paused; pauseBtn.innerHTML = paused? '<i class=\"fas fa-play\"></i>' : '<i class=\"fas fa-pause\"></i>'; });
      muteBtn.addEventListener('click', ()=>{ const on = SoundManager.toggle(); muteBtn.innerHTML = on ? '<i class=\"fas fa-volume-up\"></i>':'<i class=\"fas fa-volume-mute\"></i>'; });
      fullBtn.addEventListener('click', ()=>{ toggleFullscreen(canvas); });
      launchBtn.addEventListener('click', ()=>{ if(waitingLaunch) { waitingLaunch = false; SoundManager.play('click'); } });

      // Keyboard controls
      document.addEventListener('keydown', (e)=>{
        if(!document.getElementById('breakout-section').classList.contains('active')) return;
        if(e.key==='ArrowLeft'||e.key==='a'||e.key==='A'){ paddle.vx = -paddle.speed; }
        if(e.key==='ArrowRight'||e.key==='d'||e.key==='D'){ paddle.vx = paddle.speed; }
        if(e.key===' '){ if(waitingLaunch) { waitingLaunch = false; SoundManager.play('click'); } }
      });
      
      document.addEventListener('keyup', (e)=>{ 
        if(e.key==='ArrowLeft'||e.key==='a'||e.key==='A'){ if(paddle.vx<0) paddle.vx = 0; } 
        if(e.key==='ArrowRight'||e.key==='d'||e.key==='D'){ if(paddle.vx>0) paddle.vx = 0; } 
      });

      // Touch drag for mobile
      let dragging = false;
      canvas.addEventListener('pointerdown', (e)=>{ 
        dragging = true; 
        onPointerMove(e); 
        canvas.setPointerCapture(e.pointerId); 
        if(waitingLaunch) { waitingLaunch = false; SoundManager.play('click'); }
      });
      
      canvas.addEventListener('pointermove', (e)=>{ if(dragging) onPointerMove(e); });
      canvas.addEventListener('pointerup', (e)=>{ dragging=false; canvas.releasePointerCapture(e.pointerId); });
      canvas.addEventListener('pointercancel', ()=>{ dragging=false; });
    }

    function onPointerMove(e){
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX - rect.left);
      paddle.x = Math.max(10*scale, Math.min(width - paddle.w - 10*scale, x - paddle.w/2));
    }

    function resetGame(){
      running = false; paused = false; waitingLaunch = true;
      score = 0; lives = 3; level = 1;
      buildPaddleBall();
      buildBricks();
      scoreEl.textContent = score; livesEl.textContent = lives;
      running = true;
      requestAnimationFrame(loop);
    }

    function buildPaddleBall(){
      const paddleW = 100 * scale, paddleH = 14 * scale;
      paddle = { x: (width - paddleW)/2, y: height - 60*scale, w: paddleW, h: paddleH, vx:0, speed: 6*scale };
      ball = { x: paddle.x + paddleW/2, y: paddle.y - 12*scale, r: 10*scale, vx: 4*scale * (Math.random()>.5?1:-1), vy: -5*scale, stuck:true };
    }

    function buildBricks(){
      bricks = [];
      const rows = ROWS_BASE + Math.min(3, Math.floor((level-1)/1));
      const padding = 8*scale;
      const totalPad = padding * (COLS + 1);
      const brickW = (width - totalPad) / COLS;
      const brickH = 18*scale;
      for(let r=0;r<rows;r++){
        for(let c=0;c<COLS;c++){
          const x = padding + c*(brickW + padding);
          const y = 40*scale + r*(brickH + padding);
          const hits = 1 + Math.floor(r/2);
          const color = COLORS[r % COLORS.length];
          bricks.push({ x,y,w:brickW,h:brickH, hits, color, alive:true });
        }
      }
    }

    function loop(ts){
      if(!running) return;
      if(paused){ requestAnimationFrame(loop); return; }
      update(); draw();
      requestAnimationFrame(loop);
    }

    function update(){
      // paddle movement
      paddle.x += paddle.vx;
      // clamp paddle
      if(paddle.x < 4*scale) paddle.x = 4*scale;
      if(paddle.x + paddle.w > width - 4*scale) paddle.x = width - 4*scale - paddle.w;

      // ball
      if(waitingLaunch){ 
        ball.x = paddle.x + paddle.w/2; 
        ball.y = paddle.y - ball.r - 2*scale; 
      } else {
        ball.x += ball.vx; ball.y += ball.vy;
        // walls
        if(ball.x - ball.r < 0){ ball.x = ball.r; ball.vx *= -1; SoundManager.play('brick'); }
        if(ball.x + ball.r > width){ ball.x = width - ball.r; ball.vx *= -1; SoundManager.play('brick'); }
        if(ball.y - ball.r < 0){ ball.y = ball.r; ball.vy *= -1; SoundManager.play('brick'); }
        // paddle collision
        if(ball.y + ball.r >= paddle.y && ball.y + ball.r <= paddle.y + paddle.h && ball.x >= paddle.x && ball.x <= paddle.x + paddle.w){
          // reflect ball with variable angle
          const rel = (ball.x - (paddle.x + paddle.w/2)) / (paddle.w/2);
          const angle = rel * (Math.PI/3);
          const speed = Math.sqrt(ball.vx*ball.vx + ball.vy*ball.vy);
          ball.vx = speed * Math.sin(angle); ball.vy = -Math.abs(speed * Math.cos(angle));
          ball.y = paddle.y - ball.r - 1;
          SoundManager.play('click');
        }
        // bottom: life lost
        if(ball.y - ball.r > height){
          lives--; livesEl.textContent = lives; SoundManager.play('crash');
          if(lives <= 0){ endGame(); return; } else { waitingLaunch = true; }
        }
      }

      // bricks collision
      for(let i=0;i<bricks.length;i++){
        const b = bricks[i];
        if(!b.alive) continue;
        if(rectCircleCollide(b, ball)){
          // simple bounce
          const prevX = ball.x - ball.vx, prevY = ball.y - ball.vy;
          let collidedHoriz = prevX < b.x || prevX > b.x + b.w;
          if(collidedHoriz) ball.vx *= -1; else ball.vy *= -1;
          b.hits--; SoundManager.play('brick');
          if(b.hits <= 0){
            b.alive = false;
            score += 10;
            // faster ball slightly as level progresses
            ball.vx *= 1.03; ball.vy *= 1.03;
          } else {
            score += 5;
          }
          scoreEl.textContent = score;
        }
      }

      // check level clear
      if(bricks.every(b=>!b.alive)){
        level++; buildBricks(); // new level
        // slight reward
        lives = Math.min(lives + 1, 5);
        livesEl.textContent = lives;
        // increase ball speed a touch
        if(!waitingLaunch){ ball.vx *= 1.08; ball.vy *= 1.08; }
      }
    }

    function rectCircleCollide(rect, circle){
      const distX = Math.abs(circle.x - rect.x - rect.w/2);
      const distY = Math.abs(circle.y - rect.y - rect.h/2);
      if(distX > (rect.w/2 + circle.r)) return false;
      if(distY > (rect.h/2 + circle.r)) return false;
      if(distX <= (rect.w/2)) return true;
      if(distY <= (rect.h/2)) return true;
      const dx = distX - rect.w/2;
      const dy = distY - rect.h/2;
      return (dx*dx + dy*dy <= (circle.r*circle.r));
    }

    function draw(){
      // background
      ctx.clearRect(0,0,width,height);
      ctx.fillStyle = '#071025'; ctx.fillRect(0,0,width,height);
      // bricks
      for(const b of bricks){
        if(!b.alive) continue;
        ctx.fillStyle = b.color;
        roundRect(ctx, b.x, b.y, b.w, b.h, 6*scale);
        // inner shine
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        ctx.fillRect(b.x + b.w*0.05, b.y + b.h*0.05, b.w*0.9, b.h*0.35);
      }
      // paddle
      ctx.fillStyle = '#34d399'; roundRect(ctx, paddle.x, paddle.y, paddle.w, paddle.h, 8*scale);
      // ball
      ctx.beginPath(); ctx.fillStyle = '#fef08a'; ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill(); ctx.closePath();
      
      // Launch message
      if (waitingLaunch) {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        ctx.fillRect(0, 0, width, height);
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Tap or Press SPACE to Launch', width/2, height/2);
      }
    }

    function roundRect(ctx,x,y,w,h,r){ 
      ctx.beginPath(); 
      ctx.moveTo(x+r,y); 
      ctx.arcTo(x+w,y,x+w,y+h,r); 
      ctx.arcTo(x+w,y+h,x,y+h,r); 
      ctx.arcTo(x,y+h,x,y,r); 
      ctx.arcTo(x,y,x+w,y,r); 
      ctx.closePath(); 
      ctx.fill(); 
    }

    function endGame(){
      running=false;
      // check/save high
      if(score > high){ high = score; localStorage.setItem('breakHigh', high); highEl.textContent = high; }
      // overlay
      ctx.fillStyle = 'rgba(4,6,8,0.85)'; ctx.fillRect(0,0,width,height);
      ctx.fillStyle = '#fb7185'; ctx.font = `bold ${Math.floor(36*scale)}px Arial`; ctx.textAlign='center'; ctx.fillText('GAME OVER', width/2, height/2 - 10);
      ctx.fillStyle = '#e6eef6'; ctx.font = `${Math.floor(18*scale)}px Arial`; ctx.fillText(`Score: ${score}`, width/2, height/2 + 28);
      SoundManager.play('crash');
    }

    function loadHigh(){ 
      high = parseInt(localStorage.getItem('breakHigh')||'0',10); 
      highEl.textContent = high;
    }

    function onResize(){ setupCanvas(); draw(); }

    function stopGame(){ running=false; }

    // Public API
    return {
      init: function(){ init(); },
      stopGame: function(){ stopGame(); }
    };
  })();

  // Initialize first module on load
  window.addEventListener('load', ()=>{
    TicModule.init();
    GuessModule.init();
  });
  </script>
</body>
</html>